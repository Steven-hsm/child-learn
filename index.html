<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="ä¸“ä¸ºé’å°‘å¹´è®¾è®¡çš„å¤šåª’ä½“å†…å®¹å¹³å°ï¼Œæä¾›ä¹¦ç±ã€çºªå½•ç‰‡ã€ç”µè§†å‰§ã€ç”µå½±å’Œå°‘å„¿é¢‘é“ç­‰ä¼˜è´¨å†…å®¹">
    <meta name="keywords" content="é’å°‘å¹´é˜…è¯»,ä¹¦ç±æ¨è,çºªå½•ç‰‡,ç”µè§†å‰§,ç”µå½±,å°‘å„¿é¢‘é“,é€‚é¾„å†…å®¹">
    <title>é¦–é¡µ - é’å°‘å¹´é˜…è¯»å¹³å°</title>
    <link rel="stylesheet" href="./css/base.css">
    <link rel="stylesheet" href="./css/layout.css">
    <link rel="stylesheet" href="./css/components.css">
    <link rel="stylesheet" href="./css/themes.css">
</head>
<body>
    <!-- è·³è½¬åˆ°ä¸»å†…å®¹çš„æ— éšœç¢é“¾æ¥ -->
    <a href="#main-content" class="skip-to-content" aria-label="è·³è½¬åˆ°ä¸»å†…å®¹">è·³è½¬åˆ°ä¸»å†…å®¹</a>

    <!-- å¯¼èˆªæ  -->
    <header>
        <nav class="main-nav" role="navigation" aria-label="ä¸»å¯¼èˆª">
            <div class="nav-container">
                <a href="./" class="logo" aria-label="é’å°‘å¹´é˜…è¯»å¹³å°é¦–é¡µ">é’å°‘å¹´é˜…è¯»å¹³å°</a>
                
                <ul class="nav-menu" role="menubar" aria-label="å†…å®¹åˆ†ç±»èœå•">
                    <li role="none">
                        <a href="./category.html?type=books" role="menuitem" aria-label="æµè§ˆä¹¦ç±åˆ†ç±»">ğŸ“š ä¹¦ç±</a>
                    </li>
                    <li role="none">
                        <a href="./category.html?type=documentaries" role="menuitem" aria-label="æµè§ˆçºªå½•ç‰‡åˆ†ç±»">ğŸ¬ çºªå½•ç‰‡</a>
                    </li>
                    <li role="none">
                        <a href="./category.html?type=tv-series" role="menuitem" aria-label="æµè§ˆç”µè§†å‰§åˆ†ç±»">ğŸ“º ç”µè§†å‰§</a>
                    </li>
                    <li role="none">
                        <a href="./category.html?type=movies" role="menuitem" aria-label="æµè§ˆç”µå½±åˆ†ç±»">ğŸ¥ ç”µå½±</a>
                    </li>
                    <li role="none">
                        <a href="./category.html?type=kids" role="menuitem" aria-label="æµè§ˆå°‘å„¿é¢‘é“åˆ†ç±»">ğŸˆ å°‘å„¿é¢‘é“</a>
                    </li>
                    <li role="none">
                        <a href="./about.html" role="menuitem" aria-label="å…³äºå¹³å°">å…³äº</a>
                    </li>
                </ul>
                
                <div class="search-box" role="search">
                    <form action="./search.html" method="get" aria-label="æœç´¢è¡¨å•">
                        <label for="search-input" class="visually-hidden">æœç´¢å†…å®¹</label>
                        <input 
                            type="search" 
                            id="search-input"
                            name="q" 
                            placeholder="æœç´¢å†…å®¹..." 
                            aria-label="æœç´¢å†…å®¹"
                            autocomplete="off">
                        <button type="submit" aria-label="æäº¤æœç´¢">ğŸ”</button>
                    </form>
                </div>
            </div>
        </nav>
    </header>

    <!-- ä¸»å†…å®¹åŒºåŸŸ -->
    <main id="main-content" role="main">
        <!-- Hero æ¨ªå¹…åŒºåŸŸ -->
        <section class="hero" aria-labelledby="hero-title">
            <div class="container">
                <h1 id="hero-title">æ¬¢è¿æ¥åˆ°é’å°‘å¹´é˜…è¯»å¹³å°</h1>
                <p>æ¢ç´¢é€‚åˆä½ çš„ä¼˜è´¨å†…å®¹ï¼ŒåŸ¹å…»è‰¯å¥½çš„é˜…è¯»ä¹ æƒ¯</p>
            </div>
        </section>

        <!-- ç²¾é€‰æ¨èåŒºåŸŸ -->
        <section class="recommendations container" aria-labelledby="recommendations-title">
            <h2 id="recommendations-title">âœ¨ ç²¾é€‰æ¨è</h2>
            <div 
                id="recommended-content" 
                class="content-grid" 
                role="region" 
                aria-label="æ¨èå†…å®¹åˆ—è¡¨"
                aria-live="polite"
                aria-busy="true">
                <!-- æ¨èå†…å®¹å°†é€šè¿‡ JavaScript åŠ¨æ€åŠ è½½ -->
                <div class="loading" role="status" aria-label="æ­£åœ¨åŠ è½½æ¨èå†…å®¹">
                    <div class="loading-spinner" aria-hidden="true"></div>
                    <p class="loading-text">æ­£åœ¨åŠ è½½æ¨èå†…å®¹...</p>
                </div>
            </div>
        </section>

        <!-- å†…å®¹åˆ†ç±»å…¥å£åŒºåŸŸ -->
        <section class="categories container" aria-labelledby="categories-title">
            <h2 id="categories-title">ğŸ“‚ å†…å®¹åˆ†ç±»</h2>
            <div 
                id="category-list" 
                class="category-grid" 
                role="navigation" 
                aria-label="å†…å®¹åˆ†ç±»å¯¼èˆª"
                aria-live="polite"
                aria-busy="true">
                <!-- åˆ†ç±»å…¥å£å°†é€šè¿‡ JavaScript åŠ¨æ€åŠ è½½ -->
                <div class="loading" role="status" aria-label="æ­£åœ¨åŠ è½½åˆ†ç±»åˆ—è¡¨">
                    <div class="loading-spinner" aria-hidden="true"></div>
                    <p class="loading-text">æ­£åœ¨åŠ è½½åˆ†ç±»...</p>
                </div>
            </div>
        </section>
    </main>

    <!-- é¡µè„š -->
    <footer role="contentinfo">
        <div class="container">
            <p>&copy; 2024 é’å°‘å¹´é˜…è¯»å¹³å°. ä¸ºé’å°‘å¹´æä¾›å®‰å…¨ã€é€‚é¾„çš„å†…å®¹ã€‚</p>
            <p>
                <a href="./about.html" aria-label="äº†è§£æ›´å¤šå…³äºå¹³å°çš„ä¿¡æ¯">å…³äºæˆ‘ä»¬</a> | 
                <a href="./about.html#age-ratings" aria-label="æŸ¥çœ‹å¹´é¾„åˆ†çº§è¯´æ˜">å¹´é¾„åˆ†çº§è¯´æ˜</a>
            </p>
        </div>
    </footer>

    <!-- JavaScript æ¨¡å— -->
    <script src="./js/utils.js"></script>
    <script src="./js/dataLoader.js"></script>
    <script src="./js/renderer.js"></script>
    <script src="./js/router.js"></script>
    
    <!-- é¦–é¡µåˆå§‹åŒ–è„šæœ¬ -->
    <script>
        // é¦–é¡µåˆå§‹åŒ–é€»è¾‘
        document.addEventListener('DOMContentLoaded', async function() {
            try {
                // åˆå§‹åŒ–æ•°æ®åŠ è½½å™¨
                const dataLoader = new DataLoader();
                const renderer = new Renderer();
                
                // åŠ è½½ç«™ç‚¹é…ç½®å’Œå†…å®¹æ•°æ®
                const [config, content] = await Promise.all([
                    dataLoader.loadConfig(),
                    dataLoader.loadContent()
                ]);
                
                // æ¸²æŸ“æ¨èå†…å®¹
                await renderRecommendations(dataLoader, renderer);
                
                // æ¸²æŸ“åˆ†ç±»å…¥å£
                renderCategories(config, renderer);
                
                // åˆå§‹åŒ–æœç´¢æ¡†äº¤äº’
                initSearchBox();
                
                // åˆå§‹åŒ–å›¾ç‰‡æ‡’åŠ è½½
                if (typeof lazyLoadImages === 'function') {
                    lazyLoadImages(document.body);
                }
            } catch (error) {
                console.error('é¦–é¡µåˆå§‹åŒ–å¤±è´¥:', error);
                showError();
            }
        });
        
        // æ¸²æŸ“æ¨èå†…å®¹
        async function renderRecommendations(dataLoader, renderer) {
            const container = document.getElementById('recommended-content');
            container.setAttribute('aria-busy', 'false');
            
            try {
                const recommendations = await dataLoader.loadRecommendations();
                const content = await dataLoader.loadContent();
                
                if (recommendations && recommendations.length > 0) {
                    // è·å–æ¨èçš„å†…å®¹é¡¹
                    const recommendedItems = recommendations
                        .map(rec => content.find(item => item.id === rec.contentId))
                        .filter(item => item !== null && item !== undefined)
                        .slice(0, 8); // æœ€å¤šæ˜¾ç¤º 8 ä¸ªæ¨è
                    
                    if (recommendedItems.length > 0) {
                        renderer.renderContentList(container, recommendedItems);
                    } else {
                        container.innerHTML = '<p class="empty-description">æš‚æ— æ¨èå†…å®¹</p>';
                    }
                } else {
                    // å¦‚æœæ²¡æœ‰æ¨èé…ç½®ï¼Œæ˜¾ç¤ºæœ€æ–°çš„å†…å®¹
                    const latestItems = content.slice(0, 8);
                    renderer.renderContentList(container, latestItems);
                }
            } catch (error) {
                console.error('åŠ è½½æ¨èå†…å®¹å¤±è´¥:', error);
                container.innerHTML = '<p class="error-description">åŠ è½½æ¨èå†…å®¹å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•</p>';
            }
        }
        
        // æ¸²æŸ“åˆ†ç±»å…¥å£
        function renderCategories(config, renderer) {
            const container = document.getElementById('category-list');
            container.setAttribute('aria-busy', 'false');
            
            try {
                const contentTypes = config.contentTypes || [
                    { id: 'books', name: 'ä¹¦ç±', icon: 'ğŸ“š' },
                    { id: 'documentaries', name: 'çºªå½•ç‰‡', icon: 'ğŸ¬' },
                    { id: 'tv-series', name: 'ç”µè§†å‰§', icon: 'ğŸ“º' },
                    { id: 'movies', name: 'ç”µå½±', icon: 'ğŸ¥' },
                    { id: 'kids', name: 'å°‘å„¿é¢‘é“', icon: 'ğŸˆ' }
                ];
                
                container.innerHTML = contentTypes.map(type => `
                    <a href="./category.html?type=${type.id}" 
                       class="category-card" 
                       role="link"
                       aria-label="æµè§ˆ${type.name}åˆ†ç±»">
                        <span class="category-icon" aria-hidden="true">${type.icon}</span>
                        <span class="category-name">${type.name}</span>
                    </a>
                `).join('');
            } catch (error) {
                console.error('æ¸²æŸ“åˆ†ç±»å…¥å£å¤±è´¥:', error);
                container.innerHTML = '<p class="error-description">åŠ è½½åˆ†ç±»å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•</p>';
            }
        }
        
        // åˆå§‹åŒ–æœç´¢æ¡†äº¤äº’
        function initSearchBox() {
            const searchForm = document.querySelector('.search-box form');
            const searchInput = document.getElementById('search-input');
            
            if (!searchForm || !searchInput) return;
            
            // é˜²æ­¢æäº¤ç©ºæœç´¢
            searchForm.addEventListener('submit', function(e) {
                const keyword = searchInput.value.trim();
                
                if (!keyword) {
                    e.preventDefault();
                    searchInput.focus();
                    
                    // æ·»åŠ è§†è§‰åé¦ˆ
                    searchInput.classList.add('error-shake');
                    setTimeout(() => {
                        searchInput.classList.remove('error-shake');
                    }, 500);
                    
                    return false;
                }
            });
            
            // è¾“å…¥æ—¶ç§»é™¤é”™è¯¯çŠ¶æ€
            searchInput.addEventListener('input', function() {
                searchInput.classList.remove('error-shake');
            });
        }
        
        // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
        function showError() {
            const main = document.getElementById('main-content');
            main.innerHTML = `
                <div class="error-message container" role="alert">
                    <span class="error-icon" aria-hidden="true">âš ï¸</span>
                    <h2 class="error-title">åŠ è½½å¤±è´¥</h2>
                    <p class="error-description">æŠ±æ­‰ï¼Œé¡µé¢åŠ è½½é‡åˆ°é—®é¢˜ã€‚è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥ååˆ·æ–°é¡µé¢é‡è¯•ã€‚</p>
                    <button class="btn btn-primary" onclick="location.reload()" aria-label="åˆ·æ–°é¡µé¢">
                        åˆ·æ–°é¡µé¢
                    </button>
                </div>
            `;
        }
    </script>
</body>
</html>
