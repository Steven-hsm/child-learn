<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="æµè§ˆé’å°‘å¹´é˜…è¯»å¹³å°çš„åˆ†ç±»å†…å®¹ï¼ŒåŒ…æ‹¬ä¹¦ç±ã€çºªå½•ç‰‡ã€ç”µè§†å‰§ã€ç”µå½±å’Œå°‘å„¿é¢‘é“">
    <meta name="keywords" content="é’å°‘å¹´é˜…è¯»,ä¹¦ç±,çºªå½•ç‰‡,ç”µè§†å‰§,ç”µå½±,å°‘å„¿é¢‘é“,é€‚é¾„å†…å®¹">
    <meta name="author" content="é’å°‘å¹´é˜…è¯»å¹³å°">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>åˆ†ç±»åˆ—è¡¨ - é’å°‘å¹´é˜…è¯»å¹³å°</title>
    <link rel="stylesheet" href="./css/base.css">
    <link rel="stylesheet" href="./css/layout.css">
    <link rel="stylesheet" href="./css/components.css">
    <link rel="stylesheet" href="./css/themes.css">
</head>
<body>
    <nav class="main-nav" role="navigation" aria-label="ä¸»å¯¼èˆª">
        <div class="nav-container">
            <a href="./" class="logo" aria-label="é’å°‘å¹´é˜…è¯»å¹³å°é¦–é¡µ">é’å°‘å¹´é˜…è¯»å¹³å°</a>
            <button class="nav-toggle" aria-label="åˆ‡æ¢å¯¼èˆªèœå•" aria-expanded="false" aria-controls="nav-menu">
                <span class="nav-toggle-icon"></span>
            </button>
            <ul id="nav-menu" class="nav-menu" role="menubar">
                <li role="none"><a href="./category.html?type=books" role="menuitem">ä¹¦ç±</a></li>
                <li role="none"><a href="./category.html?type=documentaries" role="menuitem">çºªå½•ç‰‡</a></li>
                <li role="none"><a href="./category.html?type=tv-series" role="menuitem">ç”µè§†å‰§</a></li>
                <li role="none"><a href="./category.html?type=movies" role="menuitem">ç”µå½±</a></li>
                <li role="none"><a href="./category.html?type=kids" role="menuitem">å°‘å„¿é¢‘é“</a></li>
                <li role="none"><a href="./about.html" role="menuitem">å…³äº</a></li>
            </ul>
            <div class="search-box" role="search">
                <form action="./search.html" method="get">
                    <label for="search-input" class="visually-hidden">æœç´¢å†…å®¹</label>
                    <input type="search" id="search-input" name="q" placeholder="æœç´¢å†…å®¹..." aria-label="æœç´¢å†…å®¹" required>
                    <button type="submit" aria-label="æäº¤æœç´¢">ğŸ”</button>
                </form>
            </div>
        </div>
    </nav>

    <!-- è·³è½¬åˆ°ä¸»å†…å®¹çš„é“¾æ¥ï¼ˆæ— éšœç¢è®¿é—®ï¼‰ -->
    <a href="#main-content" class="skip-to-content">è·³è½¬åˆ°ä¸»å†…å®¹</a>

    <main id="main-content" role="main">
        <section class="category-header" aria-labelledby="category-title">
            <h1 id="category-title">å†…å®¹åˆ—è¡¨</h1>
            <p id="category-description" class="category-description"></p>
        </section>

        <section class="content-list" aria-label="å†…å®¹åˆ—è¡¨">
            <!-- åŠ è½½çŠ¶æ€ -->
            <div id="loading-indicator" class="loading-indicator" role="status" aria-live="polite" aria-label="æ­£åœ¨åŠ è½½å†…å®¹">
                <div class="spinner"></div>
                <p>æ­£åœ¨åŠ è½½å†…å®¹...</p>
            </div>

            <!-- é”™è¯¯æç¤º -->
            <div id="error-message" class="error-message" role="alert" aria-live="assertive" style="display: none;">
                <p id="error-text"></p>
                <button id="retry-button" class="btn-primary">é‡è¯•</button>
            </div>

            <!-- å†…å®¹ç½‘æ ¼å®¹å™¨ -->
            <div id="content-container" class="content-grid" role="list">
                <!-- å†…å®¹åˆ—è¡¨å°†é€šè¿‡ JavaScript åŠ¨æ€åŠ è½½ -->
            </div>

            <!-- ç©ºçŠ¶æ€æç¤º -->
            <div id="empty-state" class="empty-state" style="display: none;">
                <p>è¯¥åˆ†ç±»æš‚æ— å†…å®¹</p>
                <a href="./" class="btn-secondary">è¿”å›é¦–é¡µ</a>
            </div>
        </section>
    </main>

    <footer role="contentinfo" class="site-footer">
        <div class="footer-container">
            <p>&copy; 2024 é’å°‘å¹´é˜…è¯»å¹³å°. ä¸ºé’å°‘å¹´æä¾›å®‰å…¨ã€é€‚é¾„çš„å†…å®¹ã€‚</p>
            <nav aria-label="é¡µè„šå¯¼èˆª">
                <ul class="footer-links">
                    <li><a href="./about.html">å…³äºæˆ‘ä»¬</a></li>
                    <li><a href="./about.html#age-ratings">å¹´é¾„åˆ†çº§è¯´æ˜</a></li>
                    <li><a href="./about.html#help">ä½¿ç”¨å¸®åŠ©</a></li>
                </ul>
            </nav>
        </div>
    </footer>

    <script src="./js/utils.js"></script>
    <script src="./js/dataLoader.js"></script>
    <script src="./js/renderer.js"></script>
    <script src="./js/searchEngine.js"></script>
    <script>
        // åˆå§‹åŒ–æœç´¢æ¡†
        initSearchBox();

        // åˆ†ç±»é¡µé¢é€»è¾‘
        (async function() {
            const loadingIndicator = document.getElementById('loading-indicator');
            const errorMessage = document.getElementById('error-message');
            const errorText = document.getElementById('error-text');
            const retryButton = document.getElementById('retry-button');
            const contentContainer = document.getElementById('content-container');
            const emptyState = document.getElementById('empty-state');
            const categoryTitle = document.getElementById('category-title');
            const categoryDescription = document.getElementById('category-description');

            // è·å– URL å‚æ•°ä¸­çš„å†…å®¹ç±»å‹
            const params = parseQueryString(window.location.search);
            const contentType = params.type;

            // å†…å®¹ç±»å‹åç§°æ˜ å°„
            const typeNames = {
                'books': { name: 'ä¹¦ç±', icon: 'ğŸ“š', description: 'ç²¾é€‰é€‚åˆé’å°‘å¹´çš„ä¼˜è´¨è¯»ç‰©' },
                'documentaries': { name: 'çºªå½•ç‰‡', icon: 'ğŸ¬', description: 'å¼€é˜”è§†é‡çš„çºªå®å½±åƒ' },
                'tv-series': { name: 'ç”µè§†å‰§', icon: 'ğŸ“º', description: 'å¯“æ•™äºä¹çš„å½±è§†ä½œå“' },
                'movies': { name: 'ç”µå½±', icon: 'ğŸ¥', description: 'é€‚é¾„çš„ä¼˜è´¨ç”µå½±æ¨è' },
                'kids': { name: 'å°‘å„¿é¢‘é“', icon: 'ğŸˆ', description: 'ä¸“ä¸ºä½é¾„å„¿ç«¥è®¾è®¡çš„å†…å®¹' }
            };

            // åŠ è½½å’Œæ¸²æŸ“å†…å®¹
            async function loadContent() {
                try {
                    // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                    loadingIndicator.style.display = 'block';
                    errorMessage.style.display = 'none';
                    contentContainer.style.display = 'none';
                    emptyState.style.display = 'none';

                    // éªŒè¯å†…å®¹ç±»å‹
                    if (!contentType || !typeNames[contentType]) {
                        throw new Error('æ— æ•ˆçš„å†…å®¹ç±»å‹');
                    }

                    // æ›´æ–°é¡µé¢æ ‡é¢˜å’Œæè¿°
                    const typeInfo = typeNames[contentType];
                    categoryTitle.textContent = `${typeInfo.icon} ${typeInfo.name}`;
                    categoryDescription.textContent = typeInfo.description;
                    document.title = `${typeInfo.name} - é’å°‘å¹´é˜…è¯»å¹³å°`;

                    // åŠ è½½å†…å®¹æ•°æ®
                    const allContent = await dataLoader.loadContent();
                    
                    // ç­›é€‰æŒ‡å®šç±»å‹çš„å†…å®¹
                    const filteredContent = allContent.filter(item => item.type === contentType);

                    // éšè—åŠ è½½çŠ¶æ€
                    loadingIndicator.style.display = 'none';

                    // æ£€æŸ¥æ˜¯å¦æœ‰å†…å®¹
                    if (filteredContent.length === 0) {
                        emptyState.style.display = 'block';
                        return;
                    }

                    // æ¸²æŸ“å†…å®¹åˆ—è¡¨
                    contentContainer.style.display = 'grid';
                    renderer.renderContentList(contentContainer, filteredContent);

                    // åˆå§‹åŒ–å›¾ç‰‡æ‡’åŠ è½½
                    lazyLoadImages();

                } catch (error) {
                    console.error('åŠ è½½å†…å®¹å¤±è´¥:', error);
                    loadingIndicator.style.display = 'none';
                    errorMessage.style.display = 'block';
                    errorText.textContent = `åŠ è½½å¤±è´¥: ${error.message}`;
                }
            }

            // é‡è¯•æŒ‰é’®äº‹ä»¶
            retryButton.addEventListener('click', loadContent);

            // åˆå§‹åŠ è½½
            loadContent();
        })();
    </script>
</body>
</html>
