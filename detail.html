<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="å†…å®¹è¯¦æƒ…">
    <title>å†…å®¹è¯¦æƒ… - é’å°‘å¹´é˜…è¯»å¹³å°</title>
    <link rel="stylesheet" href="./css/base.css">
    <link rel="stylesheet" href="./css/layout.css">
    <link rel="stylesheet" href="./css/components.css">
    <link rel="stylesheet" href="./css/themes.css">
</head>
<body>
    <nav class="main-nav" role="navigation">
        <div class="nav-container">
            <a href="./" class="logo">é’å°‘å¹´é˜…è¯»å¹³å°</a>
            <ul class="nav-menu">
                <li><a href="./category.html?type=books">ä¹¦ç±</a></li>
                <li><a href="./category.html?type=documentaries">çºªå½•ç‰‡</a></li>
                <li><a href="./category.html?type=tv-series">ç”µè§†å‰§</a></li>
                <li><a href="./category.html?type=movies">ç”µå½±</a></li>
                <li><a href="./category.html?type=kids">å°‘å„¿é¢‘é“</a></li>
                <li><a href="./about.html">å…³äº</a></li>
            </ul>
            <div class="search-box">
                <form action="./search.html" method="get">
                    <input type="search" name="q" placeholder="æœç´¢å†…å®¹..." aria-label="æœç´¢">
                    <button type="submit" aria-label="æäº¤æœç´¢">ğŸ”</button>
                </form>
            </div>
        </div>
    </nav>

    <main class="main-content">
        <div class="back-button">
            <button onclick="history.back()" aria-label="è¿”å›ä¸Šä¸€é¡µ" class="btn-back">â† è¿”å›</button>
        </div>

        <article id="content-detail" class="detail-container" role="main" aria-live="polite">
            <!-- å†…å®¹è¯¦æƒ…å°†é€šè¿‡ JavaScript åŠ¨æ€åŠ è½½ -->
        </article>
    </main>

    <footer>
        <p>&copy; 2024 é’å°‘å¹´é˜…è¯»å¹³å°. ä¸ºé’å°‘å¹´æä¾›å®‰å…¨ã€é€‚é¾„çš„å†…å®¹ã€‚</p>
    </footer>

    <script src="./js/utils.js"></script>
    <script src="./js/dataLoader.js"></script>
    <script src="./js/renderer.js"></script>
    <script>
        // å†…å®¹è¯¦æƒ…é¡µé€»è¾‘
        (async function initDetailPage() {
            const container = document.getElementById('content-detail');
            
            if (!container) {
                console.error('è¯¦æƒ…å®¹å™¨ä¸å­˜åœ¨');
                return;
            }
            
            try {
                // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                renderer.renderLoading(container);
                
                // ä» URL è·å–å†…å®¹ ID
                const params = parseQueryString(window.location.href);
                const contentId = params.id;
                
                if (!contentId) {
                    renderer.renderError(container, 'ç¼ºå°‘å†…å®¹ ID å‚æ•°');
                    return;
                }
                
                // åŠ è½½å†…å®¹æ•°æ®
                const content = await dataLoader.getContentById(contentId);
                
                if (!content) {
                    renderer.renderError(container, 'æœªæ‰¾åˆ°è¯¥å†…å®¹ï¼Œå¯èƒ½å·²è¢«åˆ é™¤æˆ–ä¸å­˜åœ¨');
                    return;
                }
                
                // æ¸²æŸ“å†…å®¹è¯¦æƒ…
                renderer.renderContentDetail(container, content);
                
                // æ›´æ–°é¡µé¢æ ‡é¢˜
                document.title = `${content.title} - é’å°‘å¹´é˜…è¯»å¹³å°`;
                
                // ä¸ºå¤–éƒ¨é“¾æ¥æ·»åŠ è·³è½¬æç¤º
                addExternalLinkWarning();
                
                // å¯ç”¨å›¾ç‰‡æ‡’åŠ è½½
                lazyLoadImages(container);
                
            } catch (error) {
                console.error('åŠ è½½å†…å®¹è¯¦æƒ…å¤±è´¥:', error);
                renderer.renderError(container, `åŠ è½½å¤±è´¥: ${error.message}`);
            }
        })();
        
        /**
         * ä¸ºå¤–éƒ¨é“¾æ¥æ·»åŠ è·³è½¬æç¤º
         */
        function addExternalLinkWarning() {
            const externalLinks = document.querySelectorAll('.detail-links a[target="_blank"]');
            
            externalLinks.forEach(link => {
                const href = link.getAttribute('href');
                
                // åªå¯¹çœŸæ­£çš„å¤–éƒ¨é“¾æ¥ï¼ˆhttp/https å¼€å¤´ä¸”ä¸æ˜¯ç›¸å¯¹è·¯å¾„ï¼‰æ˜¾ç¤ºæç¤º
                if (href && (href.startsWith('http://') || href.startsWith('https://')) && !href.startsWith(window.location.origin)) {
                    link.addEventListener('click', function(e) {
                        const confirmed = confirm('æ‚¨å³å°†è®¿é—®å¤–éƒ¨é“¾æ¥ï¼Œè¯·ç¡®ä¿è¯¥é“¾æ¥å®‰å…¨å¯ä¿¡ã€‚æ˜¯å¦ç»§ç»­ï¼Ÿ');
                        
                        if (!confirmed) {
                            e.preventDefault();
                        }
                    });
                }
            });
        }
        
        // åˆå§‹åŒ–æœç´¢æ¡†
        initSearchBox();
    </script>
</body>
</html>
